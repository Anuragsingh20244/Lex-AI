<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lex AI ‚Äî Indian Legal Assistant</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;0,700;1,300;1,400&family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --navy:#080c18; --surface:#0e1220; --surface2:#141828;
            --border:#1e2438; --border2:#252d45;
            --gold:#c8a84b; --gold2:#e2c46a;
            --saffron:#e05c1a; --saffron2:#f07030;
            --text:#e6e3dc; --text2:#8e8b83; --text3:#4e4c47; --white:#f4f1eb;
        }
        *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
        html, body { height:100%; background:var(--navy); color:var(--text); font-family:'DM Sans',sans-serif; overflow:hidden; }
        body::before { content:''; position:fixed; top:-20vh; left:-10vw; width:70vw; height:70vh; background:radial-gradient(ellipse,rgba(224,92,26,0.07) 0%,transparent 65%); pointer-events:none; z-index:0; }
        body::after { content:''; position:fixed; bottom:-25vh; right:-15vw; width:60vw; height:60vh; background:radial-gradient(ellipse,rgba(200,168,75,0.06) 0%,transparent 65%); pointer-events:none; z-index:0; }

        .chakra-bg { position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); width:min(70vw,70vh); height:min(70vw,70vh); opacity:0.018; pointer-events:none; z-index:0; animation:spin 120s linear infinite; }
        @keyframes spin { to{transform:translate(-50%,-50%) rotate(360deg);} }

        .app { display:flex; flex-direction:column; height:100vh; position:relative; z-index:1; }

        /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
        header { display:flex; align-items:center; padding:0 32px; height:64px; flex-shrink:0; background:rgba(8,12,24,0.6); backdrop-filter:blur(28px); border-bottom:1px solid rgba(200,168,75,0.14); animation:slideDown 0.7s cubic-bezier(0.22,1,0.36,1) both; }
        @keyframes slideDown { from{opacity:0;transform:translateY(-100%);} to{opacity:1;transform:translateY(0);} }
        .logo-wrap { display:flex; align-items:center; gap:13px; }
        .logo-emblem { width:36px; height:36px; flex-shrink:0; }
        .logo-name { font-family:'Cormorant Garamond',serif; font-size:26px; font-weight:700; letter-spacing:-0.6px; color:var(--white); }
        .logo-name .ai { color:var(--saffron); }
        .logo-tagline { font-size:10px; color:var(--text3); letter-spacing:0.1em; text-transform:uppercase; }
        .header-center { margin:0 auto; display:flex; gap:6px; }
        .law-chip { font-family:'DM Mono',monospace; font-size:10px; color:var(--text3); background:rgba(255,255,255,0.03); border:1px solid var(--border); padding:3px 9px; border-radius:100px; }
        .header-right { display:flex; align-items:center; gap:12px; }
        .online-pill { display:flex; align-items:center; gap:7px; padding:5px 13px; border-radius:100px; background:rgba(200,168,75,0.07); border:1px solid rgba(200,168,75,0.18); font-size:12px; color:var(--gold2); }
        .online-dot { width:6px; height:6px; border-radius:50%; background:#4dba7f; box-shadow:0 0 6px #4dba7f; animation:pulse 2.4s ease-in-out infinite; }
        @keyframes pulse { 0%,100%{opacity:1;} 50%{opacity:0.3;} }

        /* AUTH HEADER ELEMENTS */
        .login-btn { padding:7px 16px; border-radius:100px; background:linear-gradient(135deg,var(--saffron),#c04810); border:none; color:white; font-size:13px; font-family:'DM Sans',sans-serif; font-weight:500; cursor:pointer; transition:all 0.2s; box-shadow:0 4px 14px rgba(224,92,26,0.3); }
        .login-btn:hover { transform:translateY(-1px); box-shadow:0 6px 20px rgba(224,92,26,0.4); }
        .user-pill { display:flex; align-items:center; gap:9px; padding:5px 14px 5px 6px; border-radius:100px; background:rgba(200,168,75,0.07); border:1px solid rgba(200,168,75,0.18); }
        .user-avatar { width:26px; height:26px; border-radius:50%; background:linear-gradient(135deg,var(--saffron),var(--gold)); display:flex; align-items:center; justify-content:center; font-size:12px; color:white; font-weight:600; }
        .user-name { font-size:12px; color:var(--gold2); font-weight:500; max-width:110px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
        .logout-btn { background:none; border:none; color:var(--text3); cursor:pointer; font-size:11px; font-family:'DM Sans',sans-serif; padding:2px 6px; }
        .logout-btn:hover { color:var(--saffron); }

        /* ‚îÄ‚îÄ CHAT ‚îÄ‚îÄ */
        #chat { flex:1; overflow-y:auto; scroll-behavior:smooth; }
        #chat::-webkit-scrollbar { width:3px; }
        #chat::-webkit-scrollbar-thumb { background:var(--border2); border-radius:2px; }

        /* ‚îÄ‚îÄ WELCOME ‚îÄ‚îÄ */
        .welcome { display:flex; flex-direction:column; align-items:center; justify-content:center; min-height:calc(100vh - 64px - 120px - 34px); padding:48px 24px; animation:fadeUp 1s cubic-bezier(0.22,1,0.36,1) 0.1s both; }
        @keyframes fadeUp { from{opacity:0;transform:translateY(40px);} to{opacity:1;transform:translateY(0);} }
        .welcome-seal { width:86px; height:86px; margin-bottom:30px; filter:drop-shadow(0 0 24px rgba(200,168,75,0.2)); animation:float 6s ease-in-out infinite; }
        @keyframes float { 0%,100%{transform:translateY(0);} 50%{transform:translateY(-6px);} }
        .welcome-headline { font-family:'Cormorant Garamond',serif; font-size:clamp(34px,5vw,52px); font-weight:600; color:var(--white); letter-spacing:-1.5px; line-height:1.05; text-align:center; margin-bottom:12px; }
        .welcome-headline em { color:var(--saffron); font-style:italic; }
        .welcome-sub { font-size:15px; color:var(--text2); margin-bottom:48px; text-align:center; font-weight:300; }
        .gold-rule { width:48px; height:1px; background:linear-gradient(90deg,transparent,var(--gold),transparent); margin:0 auto 40px; }
        .try-label { font-size:10px; color:var(--text3); text-transform:uppercase; letter-spacing:0.14em; margin-bottom:16px; text-align:center; }
        .suggestions { display:flex; flex-wrap:wrap; gap:10px; justify-content:center; max-width:680px; }
        .sug { background:var(--surface); border:1px solid var(--border); color:var(--text2); padding:9px 17px; border-radius:100px; cursor:pointer; font-size:13px; font-family:'DM Sans',sans-serif; transition:all 0.2s; }
        .sug:hover { border-color:rgba(224,92,26,0.5); color:var(--saffron2); background:rgba(224,92,26,0.07); transform:translateY(-2px); }

        /* ‚îÄ‚îÄ MESSAGES ‚îÄ‚îÄ */
        .msgs { padding:24px 0 16px; display:flex; flex-direction:column; }
        .msg-row { display:flex; align-items:flex-start; padding:5px 36px; animation:msgIn 0.35s cubic-bezier(0.22,1,0.36,1) both; }
        @keyframes msgIn { from{opacity:0;transform:translateY(14px);} to{opacity:1;transform:translateY(0);} }
        .msg-row.user { justify-content:flex-end; }
        .user-bubble { max-width:65%; background:linear-gradient(135deg,var(--saffron),#c44d10); color:#fff; padding:13px 18px; border-radius:20px 20px 5px 20px; font-size:14.5px; line-height:1.7; box-shadow:0 4px 20px rgba(224,92,26,0.25); }
        .bot-side { display:flex; align-items:flex-start; gap:10px; max-width:72%; }
        .bot-avatar { width:30px; height:30px; border-radius:9px; background:linear-gradient(135deg,rgba(200,168,75,0.2),rgba(224,92,26,0.15)); border:1px solid rgba(200,168,75,0.25); display:flex; align-items:center; justify-content:center; font-size:15px; flex-shrink:0; margin-top:2px; }
        .bot-bubble { background:rgba(14,18,32,0.85); backdrop-filter:blur(12px); border:1px solid var(--border2); border-radius:5px 20px 20px 20px; padding:16px 20px; font-size:14.5px; line-height:1.8; color:var(--text); }
        .bot-bubble .section-title { font-family:'Cormorant Garamond',serif; font-size:16px; font-weight:600; color:var(--gold2); margin:14px 0 6px; }
        .bot-bubble .section-title:first-child { margin-top:0; }
        .bot-bubble .law-cite { display:inline-block; background:rgba(200,168,75,0.1); border:1px solid rgba(200,168,75,0.22); color:var(--gold2); font-family:'DM Mono',monospace; font-size:11.5px; padding:2px 8px; border-radius:5px; margin:2px 3px; }
        .bot-bubble .bullet-item { display:flex; gap:10px; margin:5px 0; align-items:flex-start; }
        .bot-bubble .bullet-dot { width:5px; height:5px; border-radius:50%; background:var(--saffron); flex-shrink:0; margin-top:9px; }

        /* ‚îÄ‚îÄ FEEDBACK ‚îÄ‚îÄ */
        .feedback-row { display:flex; align-items:center; gap:10px; padding:4px 36px 4px 76px; animation:msgIn 0.3s ease both; }
        .feedback-label { font-size:11.5px; color:var(--text3); font-style:italic; }
        .fb-btn { background:var(--surface2); border:1px solid var(--border); border-radius:8px; padding:4px 11px; cursor:pointer; font-size:12px; color:var(--text3); font-family:'DM Sans',sans-serif; transition:all 0.2s; }
        .fb-btn.up:hover, .fb-btn.selected-up { border-color:#4dba7f; color:#4dba7f; background:rgba(77,186,127,0.08); }
        .fb-btn.down:hover, .fb-btn.selected-down { border-color:var(--saffron); color:var(--saffron); background:rgba(224,92,26,0.08); }
        .feedback-thanks { font-size:11.5px; color:#4dba7f; font-style:italic; }
        .feedback-sorry { font-size:11.5px; color:var(--text2); font-style:italic; }

        /* ‚îÄ‚îÄ THINKING ‚îÄ‚îÄ */
        .thinking-side { display:flex; align-items:center; gap:10px; padding:5px 36px; animation:msgIn 0.35s both; }
        .thinking-bubble { background:rgba(14,18,32,0.85); backdrop-filter:blur(12px); border:1px solid var(--border2); border-radius:5px 20px 20px 20px; padding:13px 18px; display:flex; align-items:center; gap:10px; font-size:13px; color:var(--text3); font-style:italic; }
        .dots { display:flex; gap:5px; }
        .dots span { width:5px; height:5px; border-radius:50%; background:var(--saffron); animation:dotPop 1.3s ease-in-out infinite; }
        .dots span:nth-child(2){animation-delay:0.22s;} .dots span:nth-child(3){animation-delay:0.44s;}
        @keyframes dotPop { 0%,80%,100%{transform:scale(0.5);opacity:0.3;} 40%{transform:scale(1);opacity:1;} }

        /* ‚îÄ‚îÄ INPUT ‚îÄ‚îÄ */
        #input-zone { flex-shrink:0; padding:13px 36px 10px; background:rgba(6,7,9,0.75); backdrop-filter:blur(24px); border-top:1px solid rgba(200,168,75,0.1); }
        .input-wrap { display:flex; align-items:flex-end; gap:10px; background:var(--surface2); border:1px solid var(--border2); border-radius:18px; padding:11px 12px 11px 20px; transition:border-color 0.2s,box-shadow 0.2s; }
        .input-wrap:focus-within { border-color:rgba(224,92,26,0.45); box-shadow:0 0 0 3px rgba(224,92,26,0.07); }
        #q { flex:1; background:none; border:none; outline:none; color:var(--text); font-size:14.5px; font-family:'DM Sans',sans-serif; resize:none; max-height:130px; line-height:1.6; }
        #q::placeholder { color:var(--text3); }
        #send { width:40px; height:40px; border-radius:12px; background:linear-gradient(135deg,var(--saffron),#c04810); border:none; color:#fff; cursor:pointer; display:flex; align-items:center; justify-content:center; flex-shrink:0; transition:transform 0.18s,box-shadow 0.18s; box-shadow:0 4px 14px rgba(224,92,26,0.35); }
        #send:hover { transform:scale(1.07); }
        #send:disabled { opacity:0.35; cursor:not-allowed; transform:none; box-shadow:none; }
        #send svg { width:17px; height:17px; }

        /* ‚îÄ‚îÄ DISCLAIMER BAR ‚îÄ‚îÄ */
        .disc-bar { flex-shrink:0; padding:7px 36px; background:rgba(6,7,9,0.95); border-top:1px solid rgba(200,168,75,0.08); display:flex; align-items:center; justify-content:center; gap:14px; }
        .disc-text { font-size:11px; color:var(--text3); text-align:center; }
        .disc-text strong { color:rgba(200,168,75,0.7); }
        .nalsa { font-size:11px; color:var(--saffron); text-decoration:none; font-weight:500; white-space:nowrap; border-left:1px solid var(--border2); padding-left:14px; opacity:0.85; }

        /* ‚îÄ‚îÄ MODALS ‚îÄ‚îÄ */
        .modal-bg { position:fixed; inset:0; background:rgba(6,7,9,0.92); backdrop-filter:blur(20px); z-index:100; display:flex; align-items:center; justify-content:center; padding:24px; animation:fadeIn 0.4s ease both; }
        @keyframes fadeIn { from{opacity:0;} to{opacity:1;} }
        .login-modal-bg { position:fixed; inset:0; background:rgba(6,7,9,0.88); backdrop-filter:blur(20px); z-index:150; display:none; align-items:center; justify-content:center; padding:24px; }
        .login-modal-bg.show { display:flex; animation:fadeIn 0.3s ease; }
        .modal-card { background:linear-gradient(160deg,var(--surface2),var(--surface)); border:1px solid var(--border2); border-radius:22px; padding:38px; max-width:490px; width:100%; box-shadow:0 40px 100px rgba(0,0,0,0.7); animation:cardUp 0.5s cubic-bezier(0.34,1.56,0.64,1) both; position:relative; overflow:hidden; }
        .modal-card.sm { max-width:420px; text-align:center; }
        .modal-card::before { content:''; position:absolute; top:0; left:0; right:0; height:1px; background:linear-gradient(90deg,transparent,rgba(200,168,75,0.4),transparent); }
        @keyframes cardUp { from{opacity:0;transform:translateY(30px) scale(0.95);} to{opacity:1;transform:translateY(0) scale(1);} }
        .modal-icon { width:52px; height:52px; background:rgba(224,92,26,0.08); border:1px solid rgba(224,92,26,0.2); border-radius:16px; display:flex; align-items:center; justify-content:center; font-size:24px; margin-bottom:20px; }
        .modal-icon.lg { width:64px; height:64px; font-size:30px; margin:0 auto 22px; }
        .modal-card h2 { font-family:'Cormorant Garamond',serif; font-size:26px; font-weight:600; color:var(--white); margin-bottom:10px; }
        .modal-card p { font-size:14px; color:var(--text2); line-height:1.75; font-weight:300; }
        .modal-points { background:rgba(6,7,9,0.5); border:1px solid var(--border); border-radius:14px; padding:18px 20px; margin:20px 0 26px; display:flex; flex-direction:column; gap:13px; }
        .modal-pt { display:flex; gap:11px; align-items:flex-start; font-size:13.5px; color:var(--text2); line-height:1.6; }
        .modal-pt .d { width:6px; height:6px; border-radius:50%; background:var(--saffron); flex-shrink:0; margin-top:7px; }
        .modal-pt strong { color:var(--text); font-weight:500; }
        .modal-pt .gold { color:var(--gold2); font-weight:500; }
        .primary-btn { width:100%; padding:15px; background:linear-gradient(135deg,var(--saffron),#b84010); border:none; border-radius:13px; color:#fff; font-size:15px; font-family:'DM Sans',sans-serif; font-weight:500; cursor:pointer; transition:transform 0.18s; box-shadow:0 6px 24px rgba(224,92,26,0.3); margin-top:4px; }
        .primary-btn:hover { transform:translateY(-2px); }
        .google-btn { width:100%; padding:14px; background:white; border:none; border-radius:12px; color:#333; font-size:15px; font-family:'DM Sans',sans-serif; font-weight:500; cursor:pointer; display:flex; align-items:center; justify-content:center; gap:10px; transition:all 0.2s; box-shadow:0 4px 14px rgba(0,0,0,0.3); margin-top:20px; }
        .google-btn:hover { transform:translateY(-2px); box-shadow:0 8px 24px rgba(0,0,0,0.4); }
        .modal-foot { text-align:center; margin-top:14px; font-size:12px; color:var(--text3); }
        .modal-foot a { color:var(--gold); text-decoration:none; }
        .skip-btn { margin-top:12px; font-size:12px; color:var(--text3); cursor:pointer; background:none; border:none; font-family:'DM Sans',sans-serif; width:100%; padding:8px; display:block; }
        .skip-btn:hover { color:var(--text2); }

        /* ‚îÄ‚îÄ MOBILE ‚îÄ‚îÄ */
        @media (max-width:768px) {
            header { padding:0 16px; height:58px; }
            .header-center { display:none; }
            .logo-name { font-size:22px; }
            .logo-tagline { font-size:9px; }
            .welcome { padding:28px 16px; }
            .welcome-headline { font-size:30px; }
            .welcome-sub { font-size:13px; margin-bottom:32px; }
            .welcome-seal { width:64px; height:64px; margin-bottom:18px; }
            .gold-rule { margin-bottom:28px; }
            .suggestions { flex-wrap:nowrap; overflow-x:auto; justify-content:flex-start; -webkit-overflow-scrolling:touch; padding-bottom:4px; }
            .suggestions::-webkit-scrollbar { display:none; }
            .sug { white-space:nowrap; flex-shrink:0; }
            .msg-row { padding:4px 14px; }
            .user-bubble { max-width:85%; }
            .bot-side { max-width:92%; }
            .feedback-row { padding:4px 14px 4px 50px; }
            .thinking-side { padding:4px 14px; }
            #input-zone { padding:10px 14px 8px; }
            .disc-bar { padding:6px 14px; flex-wrap:wrap; gap:4px; }
            .nalsa { border-left:none; padding-left:0; }
        }
    </style>
</head>
<body>

<svg class="chakra-bg" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
    <circle cx="100" cy="100" r="95" stroke="#c8a84b" stroke-width="2" fill="none"/>
    <circle cx="100" cy="100" r="15" stroke="#c8a84b" stroke-width="2" fill="none"/>
    <g stroke="#c8a84b" stroke-width="0.8">
        <line x1="100" y1="5" x2="100" y2="195"/>
        <line x1="5" y1="100" x2="195" y2="100"/>
        <line x1="100" y1="5" x2="100" y2="195" transform="rotate(15 100 100)"/>
        <line x1="100" y1="5" x2="100" y2="195" transform="rotate(30 100 100)"/>
        <line x1="100" y1="5" x2="100" y2="195" transform="rotate(45 100 100)"/>
        <line x1="100" y1="5" x2="100" y2="195" transform="rotate(60 100 100)"/>
        <line x1="100" y1="5" x2="100" y2="195" transform="rotate(75 100 100)"/>
        <line x1="100" y1="5" x2="100" y2="195" transform="rotate(90 100 100)"/>
        <line x1="100" y1="5" x2="100" y2="195" transform="rotate(105 100 100)"/>
        <line x1="100" y1="5" x2="100" y2="195" transform="rotate(120 100 100)"/>
        <line x1="100" y1="5" x2="100" y2="195" transform="rotate(135 100 100)"/>
        <line x1="100" y1="5" x2="100" y2="195" transform="rotate(150 100 100)"/>
        <line x1="100" y1="5" x2="100" y2="195" transform="rotate(165 100 100)"/>
    </g>
</svg>

<div class="app">

    <!-- HEADER -->
    <header>
        <div class="logo-wrap">
            <div class="logo-emblem">
                <svg viewBox="0 0 38 38" fill="none">
                    <circle cx="19" cy="19" r="18" stroke="#c8a84b" stroke-width="1" opacity="0.4"/>
                    <path d="M13 11 L19 9 L25 11 L25 21 C25 26 19 30 19 30 C19 30 13 26 13 21 Z" fill="rgba(224,92,26,0.12)" stroke="#e05c1a" stroke-width="1.3"/>
                    <path d="M16 19.5 L18.2 21.5 L22.5 16.5" stroke="#e05c1a" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <div>
                <div class="logo-name">Lex<span class="ai">AI</span></div>
                <div class="logo-tagline">Indian Legal Assistant</div>
            </div>
        </div>

        <div class="header-center">
            <span class="law-chip">BNS 2023</span>
            <span class="law-chip">BNSS 2023</span>
            <span class="law-chip">Constitution</span>
            <span class="law-chip">IT Act</span>
            <span class="law-chip">RTI Act</span>
            <span class="law-chip">Consumer Protection Act</span>
            <span class="law-chip">And More...</span>
        </div>

        <div class="header-right">
            <div class="online-pill"><div class="online-dot"></div>Online</div>
            <div id="auth-area"></div>
        </div>
    </header>

    <!-- CHAT -->
    <div id="chat">
        <div class="welcome" id="welcome">
            <svg class="welcome-seal" viewBox="0 0 90 90" fill="none">
                <circle cx="45" cy="45" r="43" stroke="#c8a84b" stroke-width="1.2" opacity="0.35"/>
                <circle cx="45" cy="45" r="34" stroke="#c8a84b" stroke-width="0.6" opacity="0.2"/>
                <g stroke="#c8a84b" stroke-width="0.6" opacity="0.2">
                    <line x1="45" y1="2" x2="45" y2="88"/>
                    <line x1="2" y1="45" x2="88" y2="45"/>
                    <line x1="15" y1="15" x2="75" y2="75"/>
                    <line x1="75" y1="15" x2="15" y2="75"/>
                </g>
                <path d="M28 22 L45 17 L62 22 L62 46 C62 58 45 67 45 67 C45 67 28 58 28 46 Z" fill="rgba(224,92,26,0.1)" stroke="#e05c1a" stroke-width="1.6"/>
                <path d="M36 44 L42 50 L56 36" stroke="#e05c1a" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <h1 class="welcome-headline">Know Your <em>Rights.</em></h1>
            <p class="welcome-sub">Ask anything about Indian law ‚Äî in English or Hindi</p>
            <div class="gold-rule"></div>
            <p class="try-label">Try asking</p>
            <div class="suggestions">
                <button class="sug" onclick="useSug(this)">What are my rights if police arrest me?</button>
                <button class="sug" onclick="useSug(this)">How do I file an FIR?</button>
                <button class="sug" onclick="useSug(this)">What is bail and how to get it?</button>
                <button class="sug" onclick="useSug(this)">How to file RTI application?</button>
                <button class="sug" onclick="useSug(this)">Consumer rights for defective product?</button>
                <button class="sug" onclick="useSug(this)">Punishment for drunk driving?</button>
                <button class="sug" onclick="useSug(this)">‡§Æ‡•Å‡§ù‡•á ‡§™‡•Å‡§≤‡§ø‡§∏ ‡§®‡•á ‡§ó‡§ø‡§∞‡§´‡•ç‡§§‡§æ‡§∞ ‡§ï‡§ø‡§Ø‡§æ ‚Äî ‡§Æ‡•á‡§∞‡•á ‡§Ö‡§ß‡§ø‡§ï‡§æ‡§∞?</button>
            </div>
        </div>
        <div class="msgs" id="msgs" style="display:none;"></div>
    </div>

    <!-- INPUT -->
    <div id="input-zone">
        <div class="input-wrap">
            <textarea id="q" rows="1" placeholder="Ask a legal question in English or Hindi..."></textarea>
            <button id="send" onclick="send()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.3" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M22 2L11 13"/><path d="M22 2L15 22 11 13 2 9l20-7z"/>
                </svg>
            </button>
        </div>
    </div>

    <!-- DISCLAIMER BAR -->
    <div class="disc-bar">
        <span class="disc-text">‚öñÔ∏è <strong>Disclaimer:</strong> Lex AI provides legal information only ‚Äî not legal advice. Always consult a registered advocate.</span>
        <a href="tel:15100" class="nalsa">NALSA Free Legal Aid: 15100</a>
    </div>

</div>

<!-- DISCLAIMER MODAL -->
<div class="modal-bg" id="disclaimer-modal">
    <div class="modal-card">
        <div class="modal-icon">‚öñÔ∏è</div>
        <h2>Before You Continue</h2>
        <p>Lex AI is powered by official Indian law texts ‚Äî BNS 2023, BNSS 2023, Constitution, IT Act, RTI Act, Consumer Protection Act, and more.</p>
        <div class="modal-points">
            <div class="modal-pt"><div class="d"></div><span>Lex AI provides <strong>legal information</strong> only ‚Äî not legal advice.</span></div>
            <div class="modal-pt"><div class="d"></div><span>For arrests, charges, or court cases ‚Äî always consult a <strong>registered advocate.</strong></span></div>
            <div class="modal-pt"><div class="d"></div><span>Emergencies: <span class="gold">NALSA: 15100</span> ¬∑ Police: 100 ¬∑ Child Helpline: 1098</span></div>
        </div>
        <button class="primary-btn" onclick="closeDisclaimerModal()">I Understand ‚Äî Enter Lex AI</button>
        <div class="modal-foot">Need free legal aid? <a href="tel:15100">Call NALSA: 15100</a></div>
    </div>
</div>

<!-- LOGIN MODAL -->
<div class="login-modal-bg" id="login-modal">
    <div class="modal-card sm">
        <div class="modal-icon lg">‚öñÔ∏è</div>
        <h2>Login to Continue</h2>
        <p>Create a free account to ask legal questions and save your conversation history.</p>
        <button class="google-btn" onclick="loginWithGoogle()">
            <svg width="20" height="20" viewBox="0 0 24 24">
                <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
            </svg>
            Continue with Google
        </button>
        <button class="skip-btn" onclick="closeLoginModal()">Maybe later ‚Äî browse without saving</button>
    </div>
</div>

<script>
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // ‚ö†Ô∏è  PASTE YOUR VALUES HERE ‚Äî ONLY THESE 2 LINES
    const SUPABASE_URL = "https://papjnowgidpfsqwhproc.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBhcGpub3dnaWRwZnNxd2hwcm9jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIxNjA1MTAsImV4cCI6MjA4NzczNjUxMH0.gOW9bFrbGXbzDxqas3F4Oz0Ae2PP9jE4pscFEMsxk8k";
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    const { createClient } = supabase;
    const sb = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const qEl = document.getElementById('q');
    const msgs = document.getElementById('msgs');
    const welcome = document.getElementById('welcome');
    const sendBtn = document.getElementById('send');

    // ‚îÄ‚îÄ DISCLAIMER MODAL ‚îÄ‚îÄ
    function closeDisclaimerModal() {
        const m = document.getElementById('disclaimer-modal');
        m.style.transition = 'opacity 0.35s';
        m.style.opacity = '0';
        setTimeout(() => m.remove(), 350);
    }

    // ‚îÄ‚îÄ LOGIN MODAL ‚îÄ‚îÄ
    function closeLoginModal() {
        document.getElementById('login-modal').classList.remove('show');
        if (window._pending) {
            qEl.value = window._pending;
            qEl.dispatchEvent(new Event('input'));
            window._pending = null;
        }
    }

    // ‚îÄ‚îÄ GOOGLE LOGIN (via Supabase JS - no server redirect needed) ‚îÄ‚îÄ
    async function loginWithGoogle() {
        const { error } = await sb.auth.signInWithOAuth({
            provider: 'google',
            options: { redirectTo: window.location.origin }
        });
        if (error) alert('Login failed: ' + error.message);
    }

    async function logoutUser() {
        await sb.auth.signOut();
        await fetch('/auth/logout');
        window.userId = null;
        renderAuth(null);
    }

    function renderAuth(user) {
        const area = document.getElementById('auth-area');
        if (user) {
            const init = (user.name || user.email)[0].toUpperCase();
            const name = user.name ? user.name.split(' ')[0] : user.email.split('@')[0];
            area.innerHTML = `<div class="user-pill">
                <div class="user-avatar">${init}</div>
                <span class="user-name">${name}</span>
                <button class="logout-btn" onclick="logoutUser()">Logout</button>
            </div>`;
            window.userId = user.id;
        } else {
            area.innerHTML = `<button class="login-btn" onclick="document.getElementById('login-modal').classList.add('show')">Login with Google</button>`;
            window.userId = null;
        }
    }

    // ‚îÄ‚îÄ AUTH INIT ‚Äî checks both Supabase session and cookie ‚îÄ‚îÄ
    async function initAuth() {
        try {
            // Check if returning from Google OAuth
            const { data: { session } } = await sb.auth.getSession();
            if (session && session.user) {
                const u = session.user;
                const userData = {
                    user_id: u.id,
                    email: u.email,
                    name: u.user_metadata?.full_name || u.email.split('@')[0]
                };
                // Save to backend cookies
                await fetch('/auth/session', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(userData)
                });
                renderAuth({ id: u.id, name: userData.name, email: u.email });
                return;
            }
        } catch(e) {}

        // Fallback: check cookie session
        try {
            const res = await fetch('/auth/user');
            const data = await res.json();
            if (data.logged_in) {
                renderAuth({ id: data.user_id, name: data.name, email: data.email });
            } else {
                renderAuth(null);
            }
        } catch(e) {
            renderAuth(null);
        }
    }
    initAuth();

    // ‚îÄ‚îÄ FEEDBACK ‚îÄ‚îÄ
    async function sendFeedback(btn, rating, cid) {
        const row = btn.closest('.feedback-row');
        row.querySelectorAll('.fb-btn').forEach(b => b.disabled = true);
        btn.classList.add(rating === 'up' ? 'selected-up' : 'selected-down');
        try {
            await fetch('/feedback', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ rating, conversation_id: cid })
            });
        } catch(e) {}
        setTimeout(() => {
            row.innerHTML = rating === 'up'
                ? '<span class="feedback-thanks">‚úÖ Thanks for your feedback!</span>'
                : '<span class="feedback-sorry">üòî Sorry it wasn\'t helpful. Please consult a registered advocate.</span>';
        }, 300);
    }

    // ‚îÄ‚îÄ TEXTAREA ‚îÄ‚îÄ
    qEl.addEventListener('input', () => {
        qEl.style.height = 'auto';
        qEl.style.height = Math.min(qEl.scrollHeight, 130) + 'px';
    });
    qEl.addEventListener('keydown', e => {
        if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); send(); }
    });

    function useSug(el) { qEl.value = el.textContent.trim(); qEl.dispatchEvent(new Event('input')); send(); }
    function showMsgs() { welcome.style.display = 'none'; msgs.style.display = 'flex'; }

    // ‚îÄ‚îÄ FORMAT ‚îÄ‚îÄ
    function fmt(t) {
        t = t.replace(/\*\*(.*?)\*\*/g, '<strong style="color:var(--text);font-weight:500">$1</strong>');
        t = t.replace(/(Section|Article|Rule)\s+(\d+[A-Z]?)/g, '<span class="law-cite">$1 $2</span>');
        t = t.replace(/\b(BNS|BNSS|IPC|CrPC|POCSO|IT Act|RTI Act|Constitution|NDPS)\b/g, '<span class="law-cite">$1</span>');
        return t;
    }
    function formatAnswer(text) {
        const div = document.createElement('div');
        div.className = 'bot-bubble';
        let html = '';
        text.split('\n').forEach(line => {
            const t = line.trim();
            if (!t) { html += '<br>'; return; }
            if (/^#{1,3}\s/.test(t)) { html += `<div class="section-title">${t.replace(/^#{1,3}\s/,'')}</div>`; }
            else if (/^\*\*.*\*\*:?$/.test(t)) { html += `<div class="section-title">${t.replace(/\*\*/g,'')}</div>`; }
            else if (/^[-‚Ä¢*]\s/.test(t)) { html += `<div class="bullet-item"><div class="bullet-dot"></div><span>${fmt(t.replace(/^[-‚Ä¢*]\s/,''))}</span></div>`; }
            else if (/^\d+\.\s/.test(t)) { html += `<div class="bullet-item"><div class="bullet-dot"></div><span>${fmt(t.replace(/^\d+\.\s/,''))}</span></div>`; }
            else { html += `<p style="margin:3px 0">${fmt(t)}</p>`; }
        });
        div.innerHTML = html;
        return div;
    }

    function addUser(text) {
        showMsgs();
        const row = document.createElement('div');
        row.className = 'msg-row user';
        const b = document.createElement('div');
        b.className = 'user-bubble';
        b.textContent = text;
        row.appendChild(b);
        msgs.appendChild(row);
        scroll();
    }

    function addBot(text, cid) {
        showMsgs();
        const row = document.createElement('div');
        row.className = 'msg-row bot';
        const side = document.createElement('div');
        side.className = 'bot-side';
        const av = document.createElement('div');
        av.className = 'bot-avatar';
        av.textContent = '‚öñ';
        side.appendChild(av);
        side.appendChild(formatAnswer(text));
        row.appendChild(side);
        msgs.appendChild(row);
        // Feedback
        if (window.userId && cid) {
            const fbRow = document.createElement('div');
            fbRow.className = 'feedback-row';
            fbRow.innerHTML = `
                <span class="feedback-label">Was this helpful?</span>
                <div style="display:flex;gap:6px;">
                    <button class="fb-btn up" onclick="sendFeedback(this,'up','${cid}')">üëç Yes</button>
                    <button class="fb-btn down" onclick="sendFeedback(this,'down','${cid}')">üëé No</button>
                </div>`;
            msgs.appendChild(fbRow);
        }
        scroll();
    }

    function addThinking() {
        showMsgs();
        const wrap = document.createElement('div');
        wrap.className = 'thinking-side';
        const av = document.createElement('div');
        av.className = 'bot-avatar';
        av.textContent = '‚öñ';
        const b = document.createElement('div');
        b.className = 'thinking-bubble';
        b.innerHTML = `<span>Searching Indian law database</span><div class="dots"><span></span><span></span><span></span></div>`;
        wrap.appendChild(av);
        wrap.appendChild(b);
        msgs.appendChild(wrap);
        scroll();
        return wrap;
    }

    function scroll() { document.getElementById('chat').scrollTop = 999999; }

    // ‚îÄ‚îÄ SEND ‚îÄ‚îÄ
    async function send() {
        const text = qEl.value.trim();
        if (!text) return;
        if (!window.userId) {
            window._pending = text;
            document.getElementById('login-modal').classList.add('show');
            return;
        }
        qEl.value = '';
        qEl.style.height = 'auto';
        sendBtn.disabled = true;
        addUser(text);
        const thinking = addThinking();
        try {
            const res = await fetch('/ask', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ question: text })
            });
            const data = await res.json();
            thinking.remove();
            addBot(data.answer, data.conversation_id);
        } catch {
            thinking.remove();
            addBot('Something went wrong. Please try again.', null);
        }
        sendBtn.disabled = false;
        qEl.focus();
    }
</script>
</body>
</html>